<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PDO DB Connection | Web Backend Development</title>
  <meta name="description" content="Creating a PDO database connection with a MySQL database for CIT 336">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="../css/336course.min.css" media="screen"> </head>

<body>
  <div id="main">
    <header id="header"><img src="../images/bs_small_banner.jpg" alt="CIT 336 Banner Image"></header>
    <main>
      <article id="article">
        <h1>PDO DB Connection</h1>
        <h2>Description</h2>
        <p>PHP and MySQL databases are commonly used together. In order for PHP to interact with a database server a library of extensions or add-ons is needed. There were three such libraries of functions available: Mysql, Mysqli and PDO. <strong>The MySQL library is deprecated (dead) and should NOT be used.</strong> Of the two remaining, PDO is the newest and is widely supported. Because of this, all exercises and connections in web sites should use a PHP Data Object (PDO) to connect to the database server and interact with those databases stored on the server.</p>
        <p>The PDO connection object calls for four required parameters: the server name, the database name, the username and the password. However, the server name and database name are combined into a <q>Data Source Name</q> <abbr title='Data Source Name'>DSN</abbr>. In PDO the DSN indicates the type of database being connected to - in this case a <i>MySQL</i> database as indicated in the code examples below. Beyond the required parameters an additional parameter may also be included. In the code example below a connection to a specific database running on a specific server using the required information and includes an optional parameter to tell the server how errors should be handled. You will note that the connectivity is assigned to a connection object described using a variable named <strong>$link</strong> (<i>the variable name can be anything</i>). Once the connection is working, this file is called into other files which need to access the database (most commonly the model within the M-V-C design pattern). This call is typically performed using either the <i>require</i> or <i>require_once</i> functions. </p>
        <h2>Generic PDO Connection Example</h2>
        <p>This example shows the PDO connection within a function, it can be created outside of a function if desired.</p>
        <figure class='callout'> <pre><code>
function createConnection(){
  $server = 'dbServerName';
  $dbname= 'databaseName';
  $username = 'theUserName';
  $password = 'thePassword';
  $dsn = 'mysql:host='.$server.';dbname='.$dbname;
  $options = array(PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION);

// Create the actual connection object and assign it to a variable
  try {
     $link = new PDO($dsn, $username, $password, $options);
     return $link;
  } catch(PDOException $e) {
     echo 'Sorry, the connection failed';
     exit;
  }
}
</code></pre></figure>
        <h2>Checking for Errors</h2>
        <p>Whenever an interaction is taking place between the PHP and Database servers there is always the possibility of an error occurring. To do something with these possible errors and make them more user friendly (and hacker unfriendly) we "intercept" them. That is the reason for the <b>Try - Catch</b> syntax shown above. The connection piece in the try structure attempts to create the connection to the database server. If that fails, then the Catch structure captures the error and handles it.</p>
        <p>If a connection error occurs we can then do something about it: show an error message (when we are testing and debugging such as in the example above), or do a redirect to a more generic notice (in an actual production situation). The example below shows an actual example using the connection example demonstrated above. </p>

        <h2>An example PDO Connection</h2>
        <figure class='callout'> <pre><code>
function acmeConnection(){
  $server = 'localhost';
  $dbname= 'acme';
  $username = 'proxyUserName';
  $password = 'proxyPassword';
  $dsn = 'mysql:host='.$server.';dbname='.$dbname;
  $options = array(PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION);

// Create the actual connection object and assign it to a variable
  try {
     $link = new PDO($dsn, $username, $password, $options);
     return $link;
  } catch(PDOException $e) {
     header('Location: /errordocs/500.php');
     exit;
  }
}
</code></pre> </figure>
        <p>In this example, if a successful connection can be made to the database, the connectivity is stored in the <b>$link</b> variable and returned to where the function was called. If an error occurs, the 500.php error page is called which informs the client that a server error occurred. But, not a specific error, rather a generic error. This is user informative and hacker uninformative - just the way it should be.</p>

        <h2>Including the Connection Object</h2>
        <p>In order for any PHP file to use the database connection function, the connection file must be in "scope". To do this, the connection file is "required" into the PHP page, usually in the first 5 lines. This insures that any functionality that needs access to the data stored in the database has it available. Two examples of the code needed to make such a call are shown below:</p>
        <h3>Require Function</h3>
        <p>The connectionpage.php shown below would be the page where the connection code shown above would reside.</p>
        <figure class='callout'> <pre><code>
require($_SERVER['DOCUMENT_ROOT'].'/path/connectionpage.php');
</code></pre> </figure>
        <h3>Require_once Function</h3>
        <p>The connectionpage.php shown below would be the page where the connection code shown above would reside.</p>
        <figure class='callout'> <pre><code>
require_once($_SERVER['DOCUMENT_ROOT'].'/path/connectionpage.php');<br>
</code></pre> </figure>
        <h2>Video</h2>
       <iframe width="560" height="315" src="https://www.youtube.com/embed/nJqMKJ8zf-g" allowfullscreen></iframe>

        <h2>Connection Object Functions Used</h2>
        <ul>
          <li><a href="//us1.php.net/manual/en/pdo.connections.php" title="View the PHP online manual for the PDO connect function">PDO Connections</a></li>
          <li><a href="//php.net/manual/en/language.exceptions.php" title="View the PHP online manual for exception handling">Exception Handling</a></li>
          <li><a href="//www.php.net/manual/en/function.require-once.php" title="View the PHP online manual for the require_once function">require_once()</a></li>
          <li><a href="//php.net/manual/en/function.require.php" title="View the PHP online manual for the require function">require()</a></li>
        </ul>
      </article>
    </main>
    <footer>
      <a rel="license" href="//creativecommons.org/licenses/by-sa/3.0/deed.en_US" target="_blank"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-sa/3.0/88x31.png"></a> All materials (except as noted) are by <a href="http://blainerobertson.net" title="Visit the site" target="_blank">Blaine Robertson</a> and licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US" title="Read the license" target="_blank">Creative Commons Attribution-ShareAlike 3.0 License</a>.</footer>
  </div>
  <script src="../js/course.min.js"></script>
</body>

</html>
